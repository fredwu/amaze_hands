h1.rui-icon.rui-icon-left.rui-icon-calculator
  | Metrics for Every #{frequency} #{'Week'.pluralize(frequency)}

#charts role="tabpanel"
  ul.nav.nav-tabs role="tablist"
    li.active role="presentation": a href="#pricing"   role="tab" data-toggle="tab" Pricing
    li        role="presentation": a href="#products"  role="tab" data-toggle="tab" Products
    li        role="presentation": a href="#customers" role="tab" data-toggle="tab" Customers
  .tab-content
    #pricing.tab-pane.active
      #chart-for-pricing
    #products.tab-pane
      #chart-for-products
    #customers.tab-pane
      #chart-for-customers

coffee:
  $ ->
    $('#charts a').click (e) ->
      e.preventDefault()
      $(this).tab('show')

    getMetrics 'pricing'
    getMetrics 'products'
    getMetrics 'customers'

  getMetrics = (name) ->
    $("#chart-for-#{name}").spin()

    $.get "/metrics?name=#{name}", (metrics) ->
      $("#chart-for-#{name}").spin(false)

      chart = c3.generate
        bindto: "#chart-for-#{name}"
        data: metrics
        bar:
          width: 20
        grid:
          y:
            show: true
        axis:
          x:
            type: 'category'
            label:
              text: 'Calendar Weeks'
              position: 'outer-left'
          y:
            label:
              text: 'Days'
              position: 'outer-bottom'

      chart.hide()

      setTimeout ->
        chart.toggle 'Cycle Time (Mean)'

        setTimeout ->
          chart.toggle 'Wait Time (Mean)'

          setTimeout ->
            chart.toggle 'Cycle Time (Mean) Rolling'

            setTimeout ->
              chart.toggle ['UCL', 'CL', 'LCL']
            , 500
          , 500
        , 500
      , 500
